<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Connection Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
    }
    .status {
      padding: 20px;
      margin: 10px 0;
      border-radius: 5px;
      font-weight: bold;
    }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
    .info { background: #d1ecf1; color: #0c5460; }
    pre {
      background: #f4f4f4;
      padding: 10px;
      border-radius: 5px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <h1>üîç Connection Test</h1>
  <div id="results"></div>

  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
  <script src="config.js"></script>
  <script>
    const results = document.getElementById('results');

    function log(message, type = 'info') {
      const div = document.createElement('div');
      div.className = `status ${type}`;
      div.innerHTML = message;
      results.appendChild(div);
    }

    // Test 1: Check if Socket.io loaded
    log('‚úì Socket.io CDN loaded successfully', 'success');
    log(`Testing connection to: ${SERVER_URL}`, 'info');

    // Test 2: Try to connect
    try {
      const socket = io(SERVER_URL, {
        transports: ['websocket', 'polling'],
        reconnection: true,
        timeout: 5000
      });

      socket.on('connect', () => {
        log(`‚úì Connected! Socket ID: ${socket.id}`, 'success');
        
        // Test joining a room
        socket.emit('join-room', {
          roomId: 'test-room',
          userName: 'TestUser'
        });
      });

      socket.on('init-canvas', (data) => {
        log(`‚úì Received init-canvas event`, 'success');
        log(`<pre>${JSON.stringify(data, null, 2)}</pre>`, 'info');
      });

      socket.on('connect_error', (error) => {
        log(`‚úó Connection Error: ${error.message}`, 'error');
        log(`Make sure server is running on ${SERVER_URL}`, 'error');
      });

      socket.on('disconnect', (reason) => {
        log(`Disconnected: ${reason}`, 'error');
      });

      socket.on('error', (error) => {
        log(`Socket Error: ${error}`, 'error');
      });

    } catch (error) {
      log(`‚úó Failed to initialize: ${error.message}`, 'error');
    }

    // Test 3: Check server availability
    fetch(`${SERVER_URL}/health`)
      .then(response => response.json())
      .then(data => {
        log(`‚úì Server health check passed`, 'success');
        log(`<pre>${JSON.stringify(data, null, 2)}</pre>`, 'info');
      })
      .catch(error => {
        log(`‚úó Server health check failed: ${error.message}`, 'error');
      });
  </script>
</body>
</html>
